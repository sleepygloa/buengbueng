<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>

<sqlMap namespace="cash">

	<select id="cash_area" resultClass="dto">
		select * from paymentList
	</select>
	
	<insert id="cash_input" parameterClass="dto">
		 insert into paymentList(paying_price,buyer_chatid,payment_type,pg_name,confirmation,paying_name) values(#paying_price#,#buyer_chatid#,#payment_type#,#pg_name#,#confirmation#,#paying_name#);
	</insert>
	
	<select id="cash_payment_useInfoLoad" resultClass="userdto" parameterClass="String">
		select * from userInfo where id = #id#;
	</select>
	 
 	 <!-- 회원 로그인 했을때 이벤트로 돈 충전해주는 Log -->
	 <insert id="eventAdminGiveUserMoneyLog" parameterClass="String">
 		INSERT INTO accountLog (giveId, getId, money, method, reason, signdate) VALUES('admin', #id#, '1000', '1', '8', now());
	 </insert>
	 
	 <!-- 회원 로그인 했을때 이벤트로 돈 충전해주는 Log -->
	 <update id="eventAdminGiveUserMoney" parameterClass="java.util.HashMap">
	 	UPDATE userAccount SET money = money + #eventMoney# WHERE id = #id#;
	 </update>
	 
  	<!-- 로그아웃한 컴퓨터의 IP로 가맹점의 이용요금정책 찾기 -->
	<select id="getMoneyPolicyToIp" resultClass="int" parameterClass="String">
	select 
	    round((logoutTime - loginTime) * #payPolicy#)  as usePcUseTime, 
	    b.money as userAccoutMoney,
	    b.money - (round((logoutTime - loginTime) * #payPolicy#))  as Pay, 
	    logoutTime, loginTime 
   	from useTimeLog a INNER JOIN (select id, money from userAccount where id = #id#) b ON a.id = b.id 
   	where a.id = #id# order by loginTime desc limit 0,1;
	</select>
	 
 	<!-- 사용자 피시방 이용후 종료시 결제 -->
	<select id="userPcUseTimePay" resultClass="bossErpTotalDTO" parameterClass="java.util.HashMap">
		<![CDATA[
	select 
	    round((logoutTime - loginTime) * #payPolicy#)  as usePcUseTime, 
	    b.money as userAccoutMoney,
	    b.money - (round((logoutTime - loginTime) * #payPolicy#))  as Pay, 
	    logoutTime, loginTime 
   	from useTimeLog a INNER JOIN (select id, money from userAccount where id = #id#) b ON a.id = b.id 
   	where a.id = #id# order by loginTime desc limit 0,1;
		]]>
	</select>
	 
	 
	 
</sqlMap>