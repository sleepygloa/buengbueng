<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="admin">
	<!-- 등급별 회원 수 -->
	<select id="userCount" parameterClass="int" resultClass="int">
		select count(*) from userInfo where grade=#grade#;
	</select>
	
	<!-- 등급별 회원 목록 -->
	<select id="userList" parameterClass="java.util.HashMap" resultClass="userDto">
		<![CDATA[
		select id,pw,name,birth,phone,grade,address,email,signdate,googleId,@rownum:=@rownum+1 as rownum
		from userInfo,(select @rownum:=0)r where grade=#grade# order by signdate desc limit #startRow#,#pageSize#;
		]]>
	</select>
	
	<!-- 검색된 회원 수-->
	<select id="userSearch" parameterClass="String" resultClass="int">
		select count(*) from userInfo where 
		id like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		name like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		phone like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		email like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		address like concat('%',#keyword#,'%') COLLATE utf8_general_ci or
		googleId like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		birth like concat('%',#keyword#,'%'); 
	</select>
	
	<!-- 회원 검색 리스트-->
	<select id="userSearchList" parameterClass="java.util.HashMap" resultClass="userDto">
		select * from userInfo where 
		id like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		name like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		phone like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		email like concat('%',#keyword#,'%') COLLATE utf8_general_ci or
		address like concat('%',#keyword#,'%') COLLATE utf8_general_ci or
		googleId like concat('%',#keyword#,'%') COLLATE utf8_general_ci or 
		birth like concat('%',#keyword#,'%') limit #startRow#,#pageSize#;  
	</select>
	
	<!-- 회원 삭제 -->
	<delete id="userDelete" parameterClass="String">
		delete from userInfo where id=#id#;
	</delete>	
	
	<!-- 회원 정보 호출 -->
	<select id="getUser" parameterClass="String" resultClass="userDto" >
		select * from userInfo where id=#id#;
	</select>
	
	<!-- 회원 정보 수정 -->
	<update id="userUp" parameterClass="userDto">
		update userInfo set pw=#pw#,name=#name#,birth=#birth#,phone=#phone#,email=#email#,address=#address#,grade=#grade#,googleId=#googleId#
		where id=#id#
	</update>
	
	<!-- 당일 올라온 게시글 수 확인 -->
	<select id="franchiseAlarm" resultClass="int">
		select count(*) from customerBoard where snum=1 and re_step=0 and date(reg_date) = date(now());
	</select>
	<select id="oneAlarm" resultClass="int">
		select count(*) from customerBoard where snum=3 and re_step=0 and date(reg_date) = date(now());
	</select>

	<!-- 모든 게시글  갯수 -->
	<select id="customerAllCount" resultClass="int">
		select count(*) from customerBoard where snum=1 or snum=3;
	</select>
	
	<!-- 답변 없는 게시글 수 -->
	<select id="customerReplyCount" resultClass="int">
		<![CDATA[
		select count(*) FROM customerBoard where ref not in ( SELECT ref from customerBoard group by ref having count(ref)>1) 
		and snum not in (select snum from customerBoard where snum=2 or snum=4 or snum=5);
		]]>
	</select>
	
	<!-- 답변 없는 글-->
	<select id="customerReplyList" parameterClass="java.util.HashMap" resultClass="customerDTO">
		<![CDATA[
		select * FROM customerBoard where ref not in ( SELECT ref from customerBoard group by ref having count(ref)>1) 
		and snum not in (select snum from customerBoard where snum=2 or snum=4 or snum=5) order by reg_date desc limit #startRow#,#pageSize#;
		]]>
	</select>
	
	<!-- 게시글 검색 -->
	<select id="customerSearchCount" parameterClass="java.util.HashMap" resultClass="int" remapResults="true">
		select count(*) from customerBoard where snum!=5 and $column$ like concat('%',#keyword#,'%') collate utf8_general_ci;
	</select>
	<select id="customerSearch" parameterClass="java.util.HashMap" resultClass="customerDTO" remapResults="true">
		select * from customerBoard where snum!=5 and $column$ like concat('%',#keyword#,'%') collate utf8_general_ci order by reg_date desc limit #startRow#,#pageSize#;
	</select>
	
	<!-- 관리자 페이지 가맹점 신청 리스트 갯수 보기 -->
	<select id="getFranchiseeAddListCount" resultClass="int">
		select count(*) from franchiseeLog where result = 0;
	</select>
	
	<!-- 관리자 페이지 가맹점 신청 리스트 목록 -->
	<select id="getFranchiseeAddList" resultClass="franchiseeDTO" parameterClass="java.util.HashMap">
		<![CDATA[
		select num,date, result, date, b_id, finishDate, b_name, b_number, b_address, b_tel, b_size, b_pccount, b_ip, b_key,@rownum:=@rownum+1 as rownum
		 from franchiseeLog,(select @rownum:=0)r where result = 0 order by date asc limit #startRow#,#pageSize#;
		 ]]> 	
	</select>
	
	<!-- 가맹점 정보 불러오기:이름으로 -->
	<select id="getFranchiseeInfo" resultClass="franchiseeDTO" parameterClass="String">
		select * from franchiseeLog where b_name = #b_name#;
	</select>
	
	<!-- 관리자 페이지 가맹점 리스트 갯수 보기 -->
	<select id="getFranchiseeListCount" resultClass="int">
		select count(*) from franchiseeInfo;
	</select>
	<!-- 관리자 페이지 가맹점 리스트 목록 보기 -->
	<select id="getFranchiseeList" resultClass="franchiseeDTO" parameterClass="java.util.HashMap">
		<![CDATA[
		select *,@rownum:=@rownum+1 as rownum
		 from franchiseeInfo,(select @rownum:=0)r order by b_name asc limit #startRow#,#pageSize#;
		 ]]> 	
	</select>
	
	<!-- 관리자 페이지 검색된 가맹점 리스트 갯수 보기 -->
	<select id="getFranchiseeListSearchCount" resultClass="int" parameterClass="String">
		select count(*) from franchiseeInfo where b_name like concat('%',#keyword#,'%') COLLATE utf8_general_ci;
	</select>
	<!-- 관리자 페이지 검색된 가맹점 리스트 목록 보기 -->
	<select id="getFranchiseeSearchList" resultClass="franchiseeDTO" parameterClass="java.util.HashMap">
		<![CDATA[
		select *,@rownum:=@rownum+1 as rownum
		 from franchiseeInfo,(select @rownum:=0)r where b_name like concat('%',#keyword#,'%') COLLATE utf8_general_ci order by b_name asc limit #startRow#,#pageSize#;
		 ]]> 	
	</select>
	
	<select id="getBossFranchiseeList" resultClass="franchiseeDTO" parameterClass="java.util.HashMap">
		select b_id,b_name, b_key from franchiseeInfo order by b_id desc limit #startRow#,#pageSize#;
	</select>
</sqlMap>